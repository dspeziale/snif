<!doctype html>
<html lang="it">
<!--begin::Head-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>{% block title %}Network Scanner Dashboard{% endblock %}</title>
  <!--begin::Meta Tags-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#007bff" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
  <!--end::Meta Tags-->

  <!--begin::Fonts-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
    integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous" media="print"
    onload="this.media='all'" />
  <!--end::Fonts-->

  <!--begin::Third Party Plugins-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css"
    crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    crossorigin="anonymous" />
  <!--end::Third Party Plugins-->

  <!--begin::AdminLTE-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0-beta2/dist/css/adminlte.min.css" />
  <!--end::AdminLTE-->

  {% block extra_css %}
  <style>
    /* Enhanced theme styling */
    .app-sidebar[data-bs-theme="light"] {
      background-color: #f8f9fa !important;
      border-right: 1px solid #dee2e6;
    }

    .app-sidebar[data-bs-theme="light"] .nav-link {
      color: #212529 !important;
      transition: all 0.3s ease;
    }

    .app-sidebar[data-bs-theme="light"] .nav-link:hover {
      background-color: #e9ecef !important;
      color: #000 !important;
    }

    .app-sidebar[data-bs-theme="light"] .nav-link.active {
      background-color: #007bff !important;
      color: #fff !important;
    }

    .app-sidebar[data-bs-theme="light"] .nav-header {
      color: #6c757d !important;
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .app-sidebar[data-bs-theme="light"] .brand-text {
      color: #212529 !important;
    }

    /* Loading states */
    .menu-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 200px;
    }

    .menu-loading .spinner-border {
      color: #007bff;
    }1

    .menu-error {
      padding: 1rem;
      text-align: center;
      color: #dc3545;
    }

    /* Status indicators */
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-online { background-color: #28a745; }
    .status-offline { background-color: #dc3545; }
    .status-warning { background-color: #ffc107; }

    /* Card enhancements */
    .card {
      box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
      transition: box-shadow 0.3s ease;
    }

    .card:hover {
      box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 6px rgba(0,0,0,.3);
    }

    /* Alert positioning */
    .alert-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      max-width: 400px;
    }

    /* Navigation improvements */
    .navbar-nav .nav-link {
      color: #212529 !important;
      transition: color 0.3s ease;
    }

    .navbar-nav .nav-link:hover {
      color: #007bff !important;
    }

    /* Table improvements */
    .table-responsive {
      border-radius: 0.375rem;
    }

    .table th {
      border-top: none;
      font-weight: 600;
      background-color: #f8f9fa;
    }

    /* Breadcrumb styling */
    .breadcrumb-item + .breadcrumb-item::before {
      content: "â€º";
      color: #6c757d;
    }

    /* Button enhancements */
    .btn {
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
    }
  </style>
  {% endblock %}
</head>
<!--end::Head-->

<!--begin::Body-->
<body class="layout-fixed sidebar-expand-lg sidebar-open bg-body-tertiary">
  <!-- Alert Container -->
  <div class="alert-container" id="alertContainer"></div>

  <!--begin::App Wrapper-->
  <div class="app-wrapper">
    <!--begin::Header-->
    <nav class="app-header navbar navbar-expand bg-body">
      <div class="container-fluid">
        <!--begin::Start Navbar Links-->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button" title="Toggle Sidebar">
              <i class="bi bi-list"></i>
            </a>
          </li>
          <li class="nav-item d-none d-md-block">
            <a href="{{ url_for('index') if url_for else '/' }}" class="nav-link">
              <i class="bi bi-house me-1"></i>Home
            </a>
          </li>
          <li class="nav-item d-none d-md-block">
            <a href="" class="nav-link">
              <i class="bi bi-info-circle me-1"></i>About
            </a>
          </li>
        </ul>
        <!--end::Start Navbar Links-->

        <!--begin::End Navbar Links-->
        <ul class="navbar-nav ms-auto">
          <!--begin::System Status-->
          <li class="nav-item">
            <a class="nav-link" href="#" id="systemStatus" title="System Status">
              <span class="status-indicator status-online"></span>
              <span class="d-none d-md-inline">Online</span>
            </a>
          </li>
          <!--end::System Status-->

          <!--begin::Notifications-->
          <li class="nav-item dropdown">
            <a class="nav-link" data-bs-toggle="dropdown" href="#" title="Notifications">
              <i class="bi bi-bell-fill"></i>
              <span class="navbar-badge badge text-bg-warning" id="notificationCount">0</span>
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
              <span class="dropdown-item dropdown-header" id="notificationHeader">0 Notifications</span>
              <div class="dropdown-divider"></div>
              <div id="notificationList">
                <a href="#" class="dropdown-item">
                  <i class="bi bi-info-circle me-2 text-info"></i>
                  No new notifications
                </a>
              </div>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item dropdown-footer">View All Notifications</a>
            </div>
          </li>
          <!--end::Notifications-->

          <!--begin::Fullscreen Toggle-->
          <li class="nav-item">
            <a class="nav-link" href="#" data-lte-toggle="fullscreen" title="Fullscreen">
              <i data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i>
              <i data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none"></i>
            </a>
          </li>
          <!--end::Fullscreen Toggle-->

          <!--begin::User Menu-->
          <li class="nav-item dropdown user-menu">
            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" title="User Menu">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect width='40' height='40' fill='%23007bff'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-family='Arial' font-size='16' font-weight='bold'%3EA%3C/text%3E%3C/svg%3E"
                   class="user-image rounded-circle shadow" alt="User Image" />
              <span class="d-none d-md-inline">Admin User</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
              <li class="user-header text-bg-primary">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Crect width='80' height='80' fill='%23007bff'/%3E%3Ctext x='40' y='50' text-anchor='middle' fill='white' font-family='Arial' font-size='32' font-weight='bold'%3EA%3C/text%3E%3C/svg%3E"
                     class="rounded-circle shadow" alt="User Image" />
                <p>
                  Network Administrator
                  <small>Scanner v2.0</small>
                </p>
              </li>
              <li class="user-body">
                <div class="row">
                  <div class="col-4 text-center"><a href="#">Settings</a></div>
                  <div class="col-4 text-center"><a href="#">Reports</a></div>
                  <div class="col-4 text-center"><a href="#">Help</a></div>
                </div>
              </li>
              <li class="user-footer">
                <a href="#" class="btn btn-default btn-flat">Profile</a>
                <a href="#" class="btn btn-default btn-flat float-end">Sign out</a>
              </li>
            </ul>
          </li>
          <!--end::User Menu-->
        </ul>
        <!--end::End Navbar Links-->
      </div>
    </nav>
    <!--end::Header-->

    <!--begin::Sidebar-->
    <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="light">
      <!--begin::Sidebar Brand-->
      <div class="sidebar-brand">
        <a href="{{ url_for('index') if url_for else '/' }}" class="brand-link">
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='33' height='33' viewBox='0 0 33 33'%3E%3Crect width='33' height='33' rx='6' fill='%23007bff'/%3E%3Cpath d='M16.5 8L24 12v8l-7.5 4L9 20v-8l7.5-4z' fill='white'/%3E%3C/svg%3E"
               alt="Scanner Logo" class="brand-image opacity-75 shadow" />
          <span class="brand-text fw-light">Network Scanner</span>
        </a>
      </div>
      <!--end::Sidebar Brand-->

      <!--begin::Sidebar Wrapper-->
      <div class="sidebar-wrapper">
        <nav class="mt-2">
          <!--begin::Sidebar Menu-->
          <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="navigation"
              aria-label="Main navigation" data-accordion="false" id="navigation">

            <!-- Loading placeholder -->
            <li class="menu-loading">
              <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading menu...</span>
              </div>
              <span class="ms-2">Loading menu...</span>
            </li>
          </ul>
          <!--end::Sidebar Menu-->
        </nav>
      </div>
      <!--end::Sidebar Wrapper-->
    </aside>
    <!--end::Sidebar-->

    <!--begin::App Main-->
    <main class="app-main">
      <!--begin::App Content Header-->
      <div class="app-content-header">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <h3 class="mb-0">{% block page_title %}Dashboard{% endblock %}</h3>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-end">
                {% block breadcrumbs %}
                <li class="breadcrumb-item"><a href="{{ url_for('index') if url_for else '/' }}">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                {% endblock %}
              </ol>
            </div>
          </div>
        </div>
      </div>
      <!--end::App Content Header-->

      <!--begin::App Content-->
      <div class="app-content">
        <div class="container-fluid">
          <!-- Flash Messages -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                  <i class="bi bi-{{ 'exclamation-triangle' if category == 'error' else 'info-circle' }} me-2"></i>
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}

          {% block content %}{% endblock %}
        </div>
      </div>
      <!--end::App Content-->
    </main>
    <!--end::App Main-->

    <!--begin::Footer-->
    <footer class="app-footer">
      <div class="float-end d-none d-sm-inline">
        {% block footer_right %}Network Scanner v2.0{% endblock %}
      </div>
      <strong>
        Copyright &copy; 2025&nbsp;
        <a href="#" class="text-decoration-none">Network Scanner</a>.
      </strong>
      All rights reserved.
    </footer>
    <!--end::Footer-->
  </div>
  <!--end::App Wrapper-->

  <!-- Loading Modal -->
  <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center p-4">
          <div class="spinner-border text-primary mb-3" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <h5 id="loadingText">Processing...</h5>
          <p class="text-muted mb-0" id="loadingSubtext">Please wait while we process your request</p>
        </div>
      </div>
    </div>
  </div>

  <!--begin::Scripts-->
  <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0-beta2/dist/js/adminlte.min.js"></script>

  <!--begin::OverlayScrollbars Configure-->
  <script>
    const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
    const Default = {
      scrollbarTheme: 'os-theme-light',
      scrollbarAutoHide: 'leave',
      scrollbarClickScroll: true,
    };

    document.addEventListener('DOMContentLoaded', function () {
      const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
      if (sidebarWrapper && typeof OverlayScrollbarsGlobal !== 'undefined') {
        OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
          scrollbars: {
            theme: Default.scrollbarTheme,
            autoHide: Default.scrollbarAutoHide,
            clickScroll: Default.scrollbarClickScroll,
          },
        });
      }
    });
  </script>
  <!--end::OverlayScrollbars Configure-->

  <!-- Enhanced Menu Management -->
  <script>
    class EnhancedMenuManager {
      constructor() {
        this.currentEndpoint = '{{ request.endpoint if request else "index" }}';
        this.currentUrl = '{{ request.path if request else "/" }}';
        this.menuContainer = document.getElementById('navigation');
        this.retryCount = 0;
        this.maxRetries = 3;
        this.init();
      }

      init() {
        this.loadMenu();
        this.setupEventHandlers();
        this.setupSystemStatus();
      }

      async loadMenu() {
        try {
          this.showMenuLoading();

          const response = await fetch(`/menu/render?endpoint=${this.currentEndpoint}&url=${encodeURIComponent(this.currentUrl)}`, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            }
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          if (data.status === 'success' && data.html) {
            this.menuContainer.innerHTML = data.html;
            this.activateTreeview();
            this.setupMenuClickHandlers();
            this.retryCount = 0; // Reset retry count on success

            console.log('Menu loaded successfully:', data.active_path);
          } else {
            throw new Error(data.error || 'Unknown error loading menu');
          }
        } catch (error) {
          console.error('Error loading menu:', error);
          this.handleMenuError(error);
        }
      }

      showMenuLoading() {
        this.menuContainer.innerHTML = `
          <li class="menu-loading">
            <div class="spinner-border spinner-border-sm" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <span class="ms-2">Loading menu...</span>
          </li>
        `;
      }

      handleMenuError(error) {
        if (this.retryCount < this.maxRetries) {
          this.retryCount++;
          console.log(`Retrying menu load (${this.retryCount}/${this.maxRetries})...`);
          setTimeout(() => this.loadMenu(), 2000 * this.retryCount);
          return;
        }

        this.menuContainer.innerHTML = `
          <li class="menu-error">
            <div class="text-center">
              <i class="bi bi-exclamation-triangle text-danger fs-4"></i>
              <p class="mt-2 mb-1">Menu Load Failed</p>
              <button class="btn btn-sm btn-outline-primary" onclick="window.menuManager.loadMenu()">
                <i class="bi bi-arrow-clockwise me-1"></i>Retry
              </button>
            </div>
          </li>
          <li class="nav-item">
            <a href="/" class="nav-link">
              <i class="nav-icon bi bi-house"></i>
              <p>Dashboard</p>
            </a>
          </li>
        `;
      }

      activateTreeview() {
        // AdminLTE will handle treeview automatically
        const treeviewElements = this.menuContainer.querySelectorAll('[data-lte-toggle="treeview"]');
        console.log(`Activated ${treeviewElements.length} treeview elements`);
      }

      setupMenuClickHandlers() {
        const menuLinks = this.menuContainer.querySelectorAll('a[href]:not([href="#"])');
        menuLinks.forEach(link => {
          link.addEventListener('click', (e) => {
            const href = link.getAttribute('href');

            // Only handle internal links
            if (href && href.startsWith('/')) {
              e.preventDefault();
              this.navigateToPage(href, link);
            }
          });
        });
      }

      async navigateToPage(url, linkElement) {
        try {
          // Update active states immediately for better UX
          this.updateActiveStates(linkElement);

          // Show loading if it's a potentially slow operation
          if (url.includes('/scan/') || url.includes('/report/')) {
            this.showLoadingModal('Loading...', 'Please wait while we process your request');
          }

          // Navigate to page
          window.location.href = url;

        } catch (error) {
          console.error('Navigation error:', error);
          this.hideLoadingModal();
        }
      }

      updateActiveStates(activeLink) {
        // Remove existing active states
        this.menuContainer.querySelectorAll('.nav-link.active').forEach(link => {
          link.classList.remove('active');
        });

        this.menuContainer.querySelectorAll('.nav-item.menu-open').forEach(item => {
          item.classList.remove('menu-open');
        });

        // Add active to clicked link
        activeLink.classList.add('active');

        // Add menu-open to parent items
        let parent = activeLink.closest('li').parentElement;
        while (parent) {
          if (parent.classList.contains('nav-treeview')) {
            const parentLi = parent.parentElement;
            if (parentLi && parentLi.classList.contains('nav-item')) {
              parentLi.classList.add('menu-open');
              const parentLink = parentLi.querySelector('.nav-link');
              if (parentLink) {
                parentLink.classList.add('active');
              }
            }
          }
          parent = parent.parentElement;
        }
      }

      setupEventHandlers() {
        // Listen for menu updates
        window.addEventListener('menuUpdate', () => {
          this.loadMenu();
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
          if (!document.hidden) {
            this.checkSystemStatus();
          }
        });
      }

      async setupSystemStatus() {
        this.checkSystemStatus();
        // Check status every 30 seconds
        setInterval(() => this.checkSystemStatus(), 30000);
      }

      async checkSystemStatus() {
        try {
          const response = await fetch('/api/health', {
            method: 'GET',
            headers: { 'Accept': 'application/json' }
          });

          const statusElement = document.getElementById('systemStatus');
          const indicator = statusElement.querySelector('.status-indicator');
          const text = statusElement.querySelector('span:not(.status-indicator)');

          if (response.ok) {
            const data = await response.json();
            indicator.className = 'status-indicator status-online';
            if (text) text.textContent = 'Online';
            statusElement.title = 'System is running normally';
          } else {
            indicator.className = 'status-indicator status-warning';
            if (text) text.textContent = 'Warning';
            statusElement.title = 'System issues detected';
          }
        } catch (error) {
          const statusElement = document.getElementById('systemStatus');
          const indicator = statusElement.querySelector('.status-indicator');
          const text = statusElement.querySelector('span:not(.status-indicator)');

          indicator.className = 'status-indicator status-offline';
          if (text) text.textContent = 'Offline';
          statusElement.title = 'Cannot connect to system';
        }
      }

      showLoadingModal(title = 'Loading...', subtitle = 'Please wait...') {
        const modal = document.getElementById('loadingModal');
        const titleElement = document.getElementById('loadingText');
        const subtitleElement = document.getElementById('loadingSubtext');

        if (titleElement) titleElement.textContent = title;
        if (subtitleElement) subtitleElement.textContent = subtitle;

        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
      }

      hideLoadingModal() {
        const modal = document.getElementById('loadingModal');
        const bsModal = bootstrap.Modal.getInstance(modal);
        if (bsModal) {
          bsModal.hide();
        }
      }

      // Public methods
      refreshMenu(newEndpoint = null, newUrl = null) {
        if (newEndpoint) this.currentEndpoint = newEndpoint;
        if (newUrl) this.currentUrl = newUrl;
        this.loadMenu();
      }

      async debugMenu() {
        try {
          const response = await fetch(`/menu/debug?endpoint=${this.currentEndpoint}&url=${encodeURIComponent(this.currentUrl)}`);
          const data = await response.json();
          console.log('Menu Debug Info:', data);
          return data;
        } catch (error) {
          console.error('Debug error:', error);
        }
      }
    }

    // Utility functions for notifications and alerts
    class NotificationManager {
      constructor() {
        this.notifications = [];
        this.setupNotificationPolling();
      }

      async setupNotificationPolling() {
        // Poll for notifications every 30 seconds
        setInterval(() => this.checkNotifications(), 30000);
        this.checkNotifications(); // Check immediately
      }

      async checkNotifications() {
        try {
          const response = await fetch('/api/notifications');
          if (response.ok) {
            const data = await response.json();
            this.updateNotificationUI(data.notifications || []);
          }
        } catch (error) {
          console.error('Error checking notifications:', error);
        }
      }

      updateNotificationUI(notifications) {
        const countElement = document.getElementById('notificationCount');
        const headerElement = document.getElementById('notificationHeader');
        const listElement = document.getElementById('notificationList');

        if (countElement) {
          countElement.textContent = notifications.length;
          countElement.style.display = notifications.length > 0 ? 'inline' : 'none';
        }

        if (headerElement) {
          headerElement.textContent = `${notifications.length} Notification${notifications.length !== 1 ? 's' : ''}`;
        }

        if (listElement) {
          if (notifications.length === 0) {
            listElement.innerHTML = `
              <a href="#" class="dropdown-item">
                <i class="bi bi-info-circle me-2 text-info"></i>
                No new notifications
              </a>
            `;
          } else {
            listElement.innerHTML = notifications.slice(0, 5).map(notif => `
              <a href="#" class="dropdown-item">
                <i class="bi bi-${this.getNotificationIcon(notif.type)} me-2 text-${this.getNotificationColor(notif.type)}"></i>
                <div class="d-flex flex-column">
                  <span class="fw-bold">${notif.title}</span>
                  <small class="text-muted">${notif.message}</small>
                  <small class="text-muted">${this.formatTime(notif.timestamp)}</small>
                </div>
              </a>
            `).join('');
          }
        }
      }

      getNotificationIcon(type) {
        const icons = {
          success: 'check-circle',
          warning: 'exclamation-triangle',
          error: 'x-circle',
          info: 'info-circle'
        };
        return icons[type] || 'bell';
      }

      getNotificationColor(type) {
        const colors = {
          success: 'success',
          warning: 'warning',
          error: 'danger',
          info: 'info'
        };
        return colors[type] || 'primary';
      }

      formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);

        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;

        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;

        const days = Math.floor(hours / 24);
        return `${days}d ago`;
      }

      showAlert(message, type = 'info', duration = 5000) {
        const alertContainer = document.getElementById('alertContainer');
        const alertId = 'alert-' + Date.now();

        const alertDiv = document.createElement('div');
        alertDiv.id = alertId;
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.style.cssText = 'margin-bottom: 10px;';
        alertDiv.innerHTML = `
          <i class="bi bi-${this.getNotificationIcon(type)} me-2"></i>
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        alertContainer.appendChild(alertDiv);

        // Auto-dismiss after duration
        setTimeout(() => {
          const alert = document.getElementById(alertId);
          if (alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }
        }, duration);

        return alertId;
      }
    }

    // Initialize managers when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      // Prevent double initialization
      if (!window.menuManager) {
        window.menuManager = new EnhancedMenuManager();
        window.notificationManager = new NotificationManager();

        // Global utility functions
        window.showAlert = (message, type, duration) => {
          return window.notificationManager.showAlert(message, type, duration);
        };

        window.showLoading = (title, subtitle) => {
          window.menuManager.showLoadingModal(title, subtitle);
        };

        window.hideLoading = () => {
          window.menuManager.hideLoadingModal();
        };

        // Debug utilities
        window.debugMenu = () => window.menuManager.debugMenu();

        console.log('Enhanced Menu Manager initialized successfully');
      }
    });
  </script>

  {% block extra_js %}{% endblock %}
  <!--end::Scripts-->
</body>
</html>